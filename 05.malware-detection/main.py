import os
import logging
import subprocess
import threading
import time



def scanFiles():

    command_desired = """md5sum * | awk '{print "whois -h hash.cymru.com " $1}' | bash | cut -d" " -f2 > /tmp/checksum.txt""" 
    
    proc = subprocess.Popen(command_desired, stdin = subprocess.PIPE, stdout = subprocess.PIPE, stderr = subprocess.PIPE,shell=True)
    proc.wait()



def scanLog():

    os.chdir('/tmp')
   
    fin = open('checksum.txt', 'r')
    Lines = fin.readlines()

    count = 0
    for line in Lines:
        count += 1
        print("Line{}: {}".format(count, line.strip()))
        
        
        if line.strip() != "NO_DATA":

            logging.basicConfig(filename = 'warning.log', filemode = 'a',
                                format = '%(asctime)s-%(filename)s-%(message)s')

            logging.error(f'[-] malware detected !! line {count}')

    fin.close()


# ----------------------------------------------------------------------------
    


try:

    path_desired = input(">> Please enter your desired path: ")

    os.chdir(path_desired)


    t1 = threading.Thread(target = scanFiles)
    t1.start()
    t1.join()

    print(f"[+] Scan of the files was completed in this path ==> {path_desired}")


except Exception as error:

    print("[-] Scan failed !! ", str(error))


else:

    print("[*] Waiting for proceed...")
    time.sleep(2)


    t2 = threading.Thread(target = scanLog)
    t2.start()
    t2.join()    



